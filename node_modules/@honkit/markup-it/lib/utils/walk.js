"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const range_utils_1 = __importDefault(require("range-utils"));
/*
 * Walk throught the children tokens tree, and execute function
 * for each token with a text range relative to the base token
 *
 * It stops at block tokens
 *
 * @param {Token} base
 * @param {Function(token, range)} iter: function to call for each range of text
 * @return {String}
 */
function walk(base, iter) {
    let offset = 0;
    const tokens = base.getTokens();
    if (tokens.size === 0) {
        iter(base, range_utils_1.default(0, base.getText().length));
        return base.getText();
    }
    return tokens.reduce((output, token) => {
        if (token.isBlock()) {
            return output;
        }
        const innerText = walk(token, (tok, range) => {
            const realRange = range_utils_1.default.moveBy(range, offset);
            iter(tok, realRange);
        });
        iter(token, range_utils_1.default(offset, innerText.length));
        offset += innerText.length;
        return output + innerText;
    }, "");
}
exports.default = walk;
